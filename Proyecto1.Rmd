---
title: "Proyecto 1: Análisis Exploratorio de Datos"
author: "Grupo 4"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
options(repos = c(CRAN = "https://cloud.r-project.org"))

# Carga de librerías permitidas y necesarias
library(haven)
library(dplyr)
library(purrr)
library(janitor)
library(stringr)
library(psych)    
library(knitr)    
library(ggplot2)  
library(corrplot) 
library(gridExtra)
library(moments)
```

```{r}
# --- 1. CARGA DE ARCHIVOS Y ESTANDARIZACIÓN ---
# Asegúrate de tener estas carpetas y archivos .sav en 'data/'
ruta <- "data/"
archivos <- list.files(path = ruta, pattern = "\\.sav$", full.names = TRUE)

leer_divorcios <- function(archivo) {
  # Lectura con limpieza de nombres
  datos <- read_sav(archivo) %>% janitor::clean_names()
  anio_archivo <- as.numeric(str_extract(archivo, "\\d{4}"))
  
  # Consistencia en la variable de año
  if (!"anioocu" %in% names(datos)) {
    datos <- datos %>% mutate(anioocu = anio_archivo)
  }
  
  # Creación de columnas temporales para evitar errores de objeto no encontrado
  if ("puehom" %in% names(datos)) {
    datos <- datos %>% mutate(pueblo_h = as.character(as_factor(puehom)))
  } else if ("pperhom" %in% names(datos)) {
    datos <- datos %>% mutate(pueblo_h = as.character(as_factor(pperhom)))
  }
  
  if ("puemuj" %in% names(datos)) {
    datos <- datos %>% mutate(pueblo_m = as.character(as_factor(puemuj)))
  } else if ("ppermuj" %in% names(datos)) {
    datos <- datos %>% mutate(pueblo_m = as.character(as_factor(ppermuj)))
  }
  
  # Estandarización de tipos de datos para la unión
  cols_char <- c("ciuohom", "ciuomuj")
  datos[cols_char[cols_char %in% names(datos)]] <- lapply(datos[cols_char[cols_char %in% names(datos)]], as.character)
  
  return(datos)
}

# SE CREA EL OBJETO 'divorcios' AQUÍ
divorcios <- map_df(archivos, leer_divorcios)

# --- 2. LIMPIEZA FINAL Y UNIFICACIÓN DE CATEGORÍAS ---
divorcios_limpio <- divorcios %>%
  mutate(
    anioocu = coalesce(anioocu, anoocu),
    
    # UNIFICACIÓN DE ETNIAS: Se agrupan todas las variantes en una sola
    pueblo_hom = case_when(
      str_detect(pueblo_h, "Ladino|Mestizo|ladino|mestizo") ~ "Ladino / Mestizo",
      str_detect(pueblo_h, "Maya|maya") ~ "Maya",
      str_detect(pueblo_h, "Xinka|Xinca|xinka|xinca") ~ "Xinka",
      str_detect(pueblo_h, "Garifuna|Garífuna") ~ "Garífuna",
      str_detect(pueblo_h, "Ignorado|ignorado") ~ "Ignorado",
      TRUE ~ str_to_title(pueblo_h)
    ),
    
    pueblo_muj = case_when(
      str_detect(pueblo_m, "Ladino|Mestizo|ladino|mestizo") ~ "Ladino / Mestizo",
      str_detect(pueblo_m, "Maya|maya") ~ "Maya",
      str_detect(pueblo_m, "Xinka|Xinca|xinka|xinca") ~ "Xinka",
      str_detect(pueblo_m, "Garifuna|Garífuna") ~ "Garífuna",
      str_detect(pueblo_m, "Ignorado|ignorado") ~ "Ignorado",
      TRUE ~ str_to_title(pueblo_m)
    ),
    
    # Tratamiento de valores ignorados (999) en edades
    edadhom = ifelse(edadhom > 100, NA, edadhom),
    edadmuj = ifelse(edadmuj > 100, NA, edadmuj)
  ) %>%
  # Se eliminan columnas auxiliares para el reporte formal
  select(-any_of(c("anoocu", "puehom", "pperhom", "puemuj", "ppermuj", "pueblo_h", "pueblo_m")))
```

# Descripción General del Conjunto de Datos

El conjunto de datos analizado corresponde a los registros de divorcios en Guatemala publicados por el INE. Se han unificado registros que abarcan un periodo superior a los 10 años para identificar patrones sociales a largo plazo.

Cantidad de observaciones: `r nrow(divorcios_limpio)` registros


Cantidad de variables: `r ncol(divorcios_limpio)` variables

# Significado y Tipo de las Variables

A continuación se detallan las 19 variables principales del conjunto de datos:
 
 
```{r}
# Creación del diccionario de variables con las descripciones solicitadas
diccionario <- data.frame(
  Variable = c(
    "depreg", "mupreg", "mesreg", "anoreg", "diaocu", 
    "mesocu", "depocu", "mupocu", "edadhom", "edadmuj", 
    "nachom", "nacmuj", "eschom", "escmuj", "ciuohom", 
    "ciuomuj", "anioocu", "pueblo_hom", "pueblo_muj"
  ),
  Significado = c(
    "Departamento de registro", "Municipio de registro", "Mes de registro", 
    "Año de registro", "Día de la ruptura", "Mes de la ruptura", 
    "Departamento del evento", "Municipio del evento", "Edad del esposo", 
    "Edad de la esposa", "Nacionalidad (Hombre)", "Nacionalidad (Mujer)", 
    "Escolaridad (Hombre)", "Escolaridad (Mujer)", "Ciudad origen (Hombre)", 
    "Ciudad origen (Mujer)", "Año del evento", "Pueblo de pertenencia del hombre (Etnia)", 
    "Pueblo de pertenencia de la mujer (Etnia)"
  ),
  Tipo = c(
    "Categórica Nominal", "Categórica Nominal", "Categórica Ordinal", 
    "Numérica Discreta", "Numérica Discreta", "Categórica Ordinal", 
    "Categórica Nominal", "Categórica Nominal", "Numérica Continua", 
    "Numérica Continua", "Categórica Nominal", "Categórica Nominal", 
    "Categórica Ordinal", "Categórica Ordinal", "Categórica Nominal", 
    "Categórica Nominal", "Numérica Discreta", "Categórica Nominal", 
    "Categórica Nominal"
  )
)

# Mostrar la tabla en el documento
kable(diccionario, caption = "Diccionario de Variables del Proyecto")
```

# Exploración de Variables Numéricas

Se analizan las variables cuantitativas mediante estadística descriptiva para entender el perfil de edad de la población.


### Medidas de Tendencia Central y Distribución

```{r}
# Seleccionamos las variables numéricas de interés
vars_cuantitativas <- divorcios_limpio %>% 
  select(edadhom, edadmuj, anioocu)

resumen_stats <- psych::describe(vars_cuantitativas) %>%
  select(n, mean, sd, median, min, max, range, skew, kurtosis)

kable(resumen_stats, digits = 2, 
      caption = "Resumen Estadístico: Tendencia Central, Distribución y Orden")
```



### Determinación de la Distribución

```{r}
# Gráfico exploratorio de distribución [cite: 65]
ggplot(divorcios_limpio, aes(x = edadhom)) +
  geom_histogram(aes(y = ..density..), bins = 30, fill = "#3498db", color = "white") +
  geom_density(color = "#e74c3c", size = 1.2) +
  labs(title = "Distribución de Edad del Hombre", x = "Edad", y = "Densidad") +
  theme_minimal()

# Gráfico exploratorio de distribución para la edad de la mujer
ggplot(divorcios_limpio, aes(x = edadmuj)) +
  geom_histogram(aes(y = ..density..), bins = 30, fill = "#e67e22", color = "white") +
  geom_density(color = "#c0392b", size = 1.2) +
  labs(title = "Distribución de Edad de la Mujer", 
       x = "Edad de la Mujer", 
       y = "Densidad") +
  theme_minimal()

```

# Análisis de Distribución y Outliers
```{r}
# Diagramas de caja para identificar cuartiles (orden) y valores fuera de rango (outliers)
p_box_h <- ggplot(divorcios_limpio, aes(y = edadhom)) +
  geom_boxplot(fill = "steelblue", outlier.color = "red", alpha = 0.7) +
  labs(title = "Caja y Bigotes: Edad Hombre", y = "Edad") +
  theme_minimal()

p_box_m <- ggplot(divorcios_limpio, aes(y = edadmuj)) +
  geom_boxplot(fill = "darkorange", outlier.color = "red", alpha = 0.7) +
  labs(title = "Caja y Bigotes: Edad Mujer", y = "Edad") +
  theme_minimal()

grid.arrange(p_box_h, p_box_m, ncol = 2)
```


# Exploración de Variables Categóricas

Se utilizan tablas de frecuencia y proporciones para estudiar las variables cualitativas

### Frecuencia por Departamento

```{r}
# TFrecuencia por Departamento
divorcios_limpio %>%
  mutate(Depto = as_factor(depocu)) %>%
  tabyl(Depto) %>%
  adorn_pct_formatting() %>%
  arrange(desc(n)) %>%
  head(10) %>%
  kable(caption = "Top Departamentos con mayor número de divorcios")
```

### Frecuencia por Municipio de Ocurrencia

```{r}
# Tabla de frecuencia por Municipio de Ocurrencia
divorcios_limpio %>%
  mutate(Municipio = as_factor(mupocu)) %>%
  tabyl(Municipio) %>%
  adorn_pct_formatting() %>%
  arrange(desc(n)) %>% 
  head(30) %>% 
  kable(caption = "Top Municipios con mayor número de divorcios")
```


### Frecuencia por Mes de Ocurrencia

```{r}
# Frecuencia por Mes de Ocurrencia
divorcios_limpio %>%
  mutate(Mes = as_factor(mesocu)) %>%
  tabyl(Mes) %>%
  adorn_pct_formatting() %>% kable()
```

### Frecuencia por Escolaridad

```{r}
# Tabla de frecuencia para Escolaridad (Ordinal)
divorcios_limpio %>%
  mutate(Escolaridad = as_factor(eschom)) %>%
  tabyl(Escolaridad) %>%
  adorn_pct_formatting() %>% kable()
```


### Frecuencia por Pueblo de Pertenencia Hombre 

```{r}
# Tabla de frecuencia para el Hombre
divorcios_limpio %>%
  tabyl(pueblo_hom) %>%
  adorn_pct_formatting() %>%
  arrange(desc(n)) %>% kable(caption = "Distribución Étnica Hombre")
```

### Frecuencia por Pueblo de Pertenencia Mujer

```{r}
# Tabla de frecuencia para la Mujer
divorcios_limpio %>%
  tabyl(pueblo_muj) %>%
  adorn_pct_formatting() %>%
  arrange(desc(n)) %>% kable(caption = "Distribución Étnica Mujer")
```



# Relaciones entre Variables

```{r}
# Gráfico de dispersión para ver la relación directa entre edades
ggplot(divorcios_limpio, aes(x = edadhom, y = edadmuj)) +
  # Usamos alpha para que los puntos sean semitransparentes (evita que se vea una mancha sólida)
  geom_point(alpha = 0.05, color = "#3498db") + 
  # Añadimos una línea de tendencia (regresión lineal) en rojo
  geom_smooth(method = "lm", color = "#e74c3c", se = TRUE) +
  labs(title = "Relación entre la Edad del Hombre y la Mujer",
       subtitle = "La línea roja indica la tendencia principal de la relación",
       x = "Edad del Hombre",
       y = "Edad de la Mujer") +
  theme_minimal()

```
#CRUCE DE VARIABLES

```{r}
# C) Cruzar variables importantes

#Escolaridad vs edad hombre

divorcios_limpio %>%
  mutate(eschom = as_factor(eschom)) %>%
  filter(eschom != "Ignorado") %>%
  ggplot(aes(x = eschom,
             y = edadhom,
             fill = eschom)) +
  geom_boxplot(outlier.alpha = 0.2) +
  theme_minimal() +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1)
  ) +
  labs(title = "Edad del hombre según nivel educativo",
       x = "Nivel educativo",
       y = "Edad")


#Escolaridad vs edad mujer

divorcios_limpio %>%
  mutate(escmuj = as_factor(escmuj)) %>%
  filter(escmuj != "Ignorado") %>%
  ggplot(aes(x = escmuj,
             y = edadmuj,
             fill = escmuj)) +
  geom_boxplot(outlier.alpha = 0.2) +
  theme_minimal() +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1)
  ) +
  labs(title = "Edad de la mujer según nivel educativo",
       x = "Nivel educativo",
       y = "Edad")

```
En la gráfica de los hombres se observa que la mediana de edad aumenta conforme aumenta el nivel educativo. El nivel educativo "básico" muestra las edades más bajas, mientras que "Postgrado" muestra las más altas. Existe superpopsición entre la distribución de las cajas, lo que indica que la escolaridad influye, sin embargo no determina completamente la edad en la que se divorcian. Además también se observan valores extremos en todos los niveles, sugiriendo que igual puede ocurrir en edades avanzadas independientemente del nivel educativo.

Por otro lado, en la gráfica de mujeres se observa un incremente progresivo desde básico hasta postgrado, el cual presenta las edades más altas y menos valores extremos. En esta gráfica se observa una asociación más fuerte entre el nivel educativo y la edad de la mujer. Indicando que las mujeres con postgrado tienden a divorciarse a mayor edad. Otro punto importante es que, en todos los niveles educativos, los hombres presentan una edad promedio mayor que las mujeres, marcando así una diferencia edad edades por género.



```{r}

#departamento vs edad

edad_dep_hom <- aggregate(edadhom ~ as_factor(depocu),
                          data = divorcios_limpio,
                          mean)

edad_dep_hom


edad_dep_muj <- aggregate(edadmuj ~ as_factor(depocu),
                          data = divorcios_limpio,
                          mean)

edad_dep_muj

div_tmp <- divorcios_limpio %>%
  mutate(depocu = as_factor(depocu))

edad_dep_hom <- aggregate(edadhom ~ depocu, data = div_tmp, mean)
edad_dep_muj <- aggregate(edadmuj ~ depocu, data = div_tmp, mean)

edad_dep_hom$sexo <- "Hombre"
edad_dep_muj$sexo <- "Mujer"

names(edad_dep_hom)[2] <- "edad_prom"
names(edad_dep_muj)[2] <- "edad_prom"

edad_dep <- rbind(edad_dep_hom, edad_dep_muj)

ggplot(edad_dep,
       aes(x = reorder(depocu, edad_prom),
           y = edad_prom,
           fill = sexo)) +
  geom_col(position = "dodge") +
  coord_flip() +
  theme_minimal() +
  labs(title = "Edad promedio de divorcio por departamento y sexo",
       x = "Departamento",
       y = "Edad promedio",
       fill = "Sexo")


```

En esta gráfica se puede observar que, independientemente del departamento, los hombres tienden a divorciarse a una edad más avanzada que las mujeres, confirmando que la brecha de edad por género es consistente en todo el país. Donde se puede ver mayor esta diferencia es en departamentos como Jutiapa o Zacapa, mientras que donde se observa una menor diferencia es en Totonicapán y Quetzaltenango. Esto sugiere que la diferencia por género constituye un rasgo estructural del divorcio y no necesariamente está relacionada con el territorio donde sucede.También se puede observar que en Totonicapán las personas suelen divorciarse a edades más jóvenes, mientras que en Izabal los divorcios ocurren a edades más avanzadas en promedio. Sin embargo, estas variaciones territoriales no modifican el patrón general por género.

```{r}

#escolaridad hombre vs escolaridad mujer

divorcios_limpio %>%
  mutate(
    eschom = as_factor(eschom),
    escmuj = as_factor(escmuj)
  ) %>%
  filter(eschom != "Ignorado", escmuj != "Ignorado") %>%
  count(eschom, escmuj) %>%
  ggplot(aes(x = eschom, y = escmuj, fill = n)) +
  geom_tile() +
  scale_fill_viridis_c() +
  theme_minimal() +
  labs(title = "Escolaridad del hombre vs escolaridad de la mujer",
       x = "Escolaridad hombre",
       y = "Escolaridad mujer")


```
Al cruzar las variables de escolaridad del hombre y escolaridad de la mujer en los divorcios se puede observar que las parejas cuyo nivel educativo es ambos diversificado presentan mayor cantidad de divorcios. También se observa un patrón en la diagonal del gráfico, donde las parejas que se divorcian tienden a tener el nivel educativo igual o muy cercano. Por otro lado, mientras más separados están los niveles educativos entre el hombre y la mujer, menor es la cantidad de divorcios. Existen algunos niveles extremos como combinación entre "Ninguno" y "Postgrado", los cuales son poco frecuentes. Esto sugiere que el nivel educativo de la pareja puede llegar a ser un factor importante al momento de tomar la decisión del divorcio.

#PREGUNTAS DE INVESTIGACION
1. ¿Es más frecuente el divorcio en las áreas más urbanas?

```{r}
divorcios_limpio %>%
  mutate(depocu = as_factor(depocu)) %>%
  count(depocu, sort = TRUE)

divorcios_limpio %>%
  mutate(depocu = as_factor(depocu)) %>%
  count(depocu) %>%
  mutate(prop = n / sum(n)) %>%
  ggplot(aes(x = reorder(depocu, prop), y = prop)) +
  geom_col(fill = "#3498db") +
  coord_flip() +
  theme_minimal() +
  labs(title = "Proporción de divorcios por departamento",
       x = "Departamento",
       y = "Proporción")

divorcios_limpio %>%
  mutate(mupocu = as_factor(mupocu)) %>%
  count(mupocu, sort = TRUE) %>%
  slice_head(n = 15) %>%
  ggplot(aes(x = reorder(mupocu, n), y = n)) +
  geom_col(fill = "#2ecc71") +
  coord_flip() +
  theme_minimal() +
  labs(title = "Top 15 municipios con más divorcios",
       x = "Municipio",
       y = "Cantidad")


```

En la tabla se muestra es mas frecuente el divorcio en las áreas que están más urbanizadas, como lo es el departamento de Guatemala, que representa aproximadamente 35% del total de los divorcios registrados. Pasa lo mismo con los municipios, los municipios con mayor concentración de divorcios, como Guatemala, Mizco, Quetzaltenango y Villa Nueva, son áreas urbanas. Por lo tanto, según indican los resultados, si se podría decir que hay mayor tasa de divorcio en los sectores urbanos del pais.


2. ¿Las personas con mayor nivel educativo se divorcian a edades más avanzadas?

```{r}
divorcios_limpio %>%
  mutate(eschom = as_factor(eschom)) %>%
  filter(eschom != "Ignorado") %>%
  ggplot(aes(x = eschom, y = edadhom, fill = eschom)) +
  geom_boxplot(outlier.alpha = 0.2) +
  theme_minimal() +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1)
  ) +
  labs(title = "Edad del hombre según nivel educativo",
       x = "Nivel educativo",
       y = "Edad")

divorcios_limpio %>%
  mutate(escmuj = as_factor(escmuj)) %>%
  filter(escmuj != "Ignorado") %>%
  ggplot(aes(x = escmuj, y = edadmuj, fill = escmuj)) +
  geom_boxplot(outlier.alpha = 0.2) +
  theme_minimal() +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1)
  ) +
  labs(title = "Edad de la mujer según nivel educativo",
       x = "Nivel educativo",
       y = "Edad")

divorcios_limpio %>%
  mutate(eschom = as_factor(eschom)) %>%
  filter(eschom != "Ignorado") %>%
  group_by(eschom) %>%
  summarise(media = mean(edadhom, na.rm = TRUE)) %>%
  ggplot(aes(x = eschom, y = media)) +
  geom_col(fill = "steelblue") +
  theme_minimal() +
  labs(title = "Edad promedio del hombre por nivel educativo",
       x = "Nivel educativo",
       y = "Edad promedio")


divorcios_limpio %>%
  mutate(escmuj = as_factor(escmuj)) %>%
  filter(escmuj != "Ignorado") %>%
  group_by(escmuj) %>%
  summarise(media = mean(edadmuj, na.rm = TRUE)) %>%
  ggplot(aes(x = escmuj, y = media)) +
  geom_col(fill = "deeppink3") +
  theme_minimal() +
  labs(title = "Edad promedio de la mujer por nivel educativo",
       x = "Nivel educativo",
       y = "Edad promedio")




```

Los resultados muestran una relación positiva entre el nivel educativo y la edad promedio de divorcio, especialmente en los niveles “universitario” y “postgrado”. Se logra identificar que, en promedio, las personas con mayor nivel educativo tienden a divorciarse a edades más altas. No obstante, las cajas se encuentran muy cercanas entre las distribuciones, por lo que el nivel educativo no determina completamente la edad de divorcio, sino que es un factor asociado. Esto se observa ya que en ambos sexos aparece un patrón similar, aunque esta relación se ve más marcada en las mujeres.

3.¿La mayoria de los divorcios ocurre en parejas con diferencias de edad más altas?

```{r}

ggplot(divorcios_limpio,
       aes(x = edadhom - edadmuj)) +
  geom_histogram(aes(y = ..density..),
                 bins = 70,
                 fill = "lightblue",
                 color = "white") +
  geom_density(color = "orange", linewidth = 1.2) +
  coord_cartesian(xlim = c(-15, 30)) +
  theme_minimal() +
  labs(title = "Distribución de la diferencia de edad",
       x = "Diferencia de edad",
       y = "Densidad")




divorcios_limpio %>%
  mutate(dif_edad = edadhom - edadmuj) %>%
  summarise(
    media = mean(dif_edad, na.rm = TRUE),
    mediana = median(dif_edad, na.rm = TRUE),
    sd = sd(dif_edad, na.rm = TRUE),
    min = min(dif_edad, na.rm = TRUE),
    max = max(dif_edad, na.rm = TRUE)
  )



```

En la gráfica se muestra que la concentración está entre -5 y 5 años y que, a medida que la diferencia aumenta, la frecuencia de matrimonios va disminuyendo. De igual forma, se observa que las diferencias mayores a 15 años son menos frecuentes. También se puede ver que las estadísticas indican una mediana de 2 años, lo que significa que la mitad de las parejas tiene una diferencia de edad de alrededor de 2 años. La desviación estándar muestra que sí existe variabilidad, aunque no es excesiva. Por lo tanto, a partir de este análisis se puede concluir que la mayoría de los divorcios no ocurre en parejas con mayor diferencia de edad. Aunque existen valores extremos con diferencias muy altas, la mayor cantidad de divorcios presenta diferencias de edad pequeñas, por lo que se contradice el supuesto inicial.


4. ¿Las parejas que se divorcian tienden a tener niveles educativos similares?
```{r}
divorcios_limpio %>%
  mutate(
    eschom = as_factor(eschom),
    escmuj = as_factor(escmuj)
  ) %>%
  filter(eschom != "Ignorado", escmuj != "Ignorado") %>%
  count(eschom, escmuj) %>%
  ggplot(aes(x = eschom, y = escmuj, fill = n)) +
  geom_tile() +
  scale_fill_viridis_c() +
  theme_minimal() +
  labs(title = "Escolaridad del hombre vs escolaridad de la mujer",
       x = "Escolaridad hombre",
       y = "Escolaridad mujer")


tabla <- divorcios_limpio %>%
  mutate(
    eschom = as_factor(eschom),
    escmuj = as_factor(escmuj)
  ) %>%
  filter(eschom != "Ignorado", escmuj != "Ignorado") %>%
  count(eschom, escmuj) %>%
  group_by(eschom) %>%
  mutate(prop = n / sum(n))

tabla


```


En la gráfica se puede observar que la mayoria de los divorcios están concentrados en la diagonal de la gráfica, donde ambos mienbros tienen el mismo nivel educativo, principalmente en el nivel de "Diversificado" De igual forma se muestra que donde los niveles educativos son muy distintos, las frecuencias son mas bajas. Por lo tanto, si se puede decir que las parejas que se divorcian tienden a tener el mismo nivel educativo o similar.  



5. ¿La edad mediana de divorcio ha disminuido con el paso del tiempo?

```{r}

divorcios_limpio %>%
  group_by(anioocu) %>%
  summarise(median_h = median(edadhom, na.rm = TRUE), .groups = "drop") %>%
  ggplot(aes(x = factor(anioocu), y = median_h, group = 1)) +
  geom_line(color = "blue", linewidth = 1.2) +
  geom_point(color = "orange", size = 3) +
  labs(title = "Edad mediana del hombre por año",
       x = "Año",
       y = "Edad mediana") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


divorcios_limpio %>%
  group_by(anioocu) %>%
  summarise(median_m = median(edadmuj, na.rm = TRUE), .groups = "drop") %>%
  ggplot(aes(x = factor(anioocu), y = median_m, group = 1)) +
  geom_line(color = "pink", linewidth = 1.2) +
  geom_point(color = "orange", size = 3) +
  labs(title = "Edad mediana de la mujer por año",
       x = "Año",
       y = "Edad mediana") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

A partir de la gráfica de la edad mediana de divorcio por año, se observa que no existe una disminución con el paso del tiempo. En el caso de los hombres, la mediana se mantiene estable entre 2013 y 2017, y posteriormente presenta un ligero aumento hasta alcanzar los 35 años en 2021 y 2022. De igual forma, en las mujeres la mediana pasa de 29 años en 2013 a 32 años en los últimos años del período analizado. Por lo tanto, los datos contradicen el supuesto inicial, ya que no se evidencia una reducción en la edad mediana de divorcio, sino más bien una tendencia leve al aumento.


# GRAFICOS EXPLORATORIOS

```{r}
# --- E) GRAFICOS EXPLORATORIOS ---

# 1) Distribuciones de edades
ggplot(divorcios_limpio, aes(x = edadhom)) +
  geom_histogram(bins = 30) +
  labs(title = "Distribución edad hombre", x = "Edad", y = "Frecuencia") +
  theme_minimal()

ggplot(divorcios_limpio, aes(x = edadmuj)) +
  geom_histogram(bins = 30) +
  labs(title = "Distribución edad mujer", x = "Edad", y = "Frecuencia") +
  theme_minimal()

# 2) Boxplots (outliers)
ggplot(divorcios_limpio, aes(y = edadhom)) +
  geom_boxplot() +
  labs(title = "Boxplot edad hombre", y = "Edad") +
  theme_minimal()

ggplot(divorcios_limpio, aes(y = edadmuj)) +
  geom_boxplot() +
  labs(title = "Boxplot edad mujer", y = "Edad") +
  theme_minimal()

# 3) Relación edad hombre vs mujer
ggplot(divorcios_limpio, aes(x = edadhom, y = edadmuj)) +
  geom_point(alpha = 0.05) +
  geom_smooth(method = "lm", se = TRUE) +
  labs(title = "Edad hombre vs edad mujer", x = "Edad hombre", y = "Edad mujer") +
  theme_minimal()

# 4) Divorcios por año (tendencia)
divorcios_limpio %>%
  count(anioocu) %>%
  ggplot(aes(x = anioocu, y = n)) +
  geom_line() +
  geom_point() +
  labs(title = "Divorcios por año", x = "Año", y = "Cantidad") +
  theme_minimal()

# 5) Top departamentos
divorcios_limpio %>%
  mutate(depocu = as_factor(depocu)) %>%
  count(depocu, sort = TRUE) %>%
  slice_head(n = 10) %>%
  ggplot(aes(x = reorder(depocu, n), y = n)) +
  geom_col() +
  coord_flip() +
  labs(title = "Top 10 departamentos (ocurrencia)", x = "Departamento", y = "Cantidad") +
  theme_minimal()
```

# CLUSTERING

```{r}
# --- F) CLUSTERING (K-means) ---

df_cluster <- divorcios_limpio %>%
  select(edadhom, edadmuj) %>%
  na.omit()

X_scaled <- scale(df_cluster)

set.seed(123)
wss <- sapply(1:8, function(k) {
  kmeans(X_scaled, centers = k, nstart = 25)$tot.withinss
})

plot(1:8, wss, type = "b",
     xlab = "Number of clusters (k)",
     ylab = "Within-cluster sum of squares",
     main = "Elbow method for optimal k")

set.seed(123)
km_model <- kmeans(X_scaled, centers = 4, nstart = 25)

df_cluster$cluster <- factor(km_model$cluster)

cluster_summary <- df_cluster %>%
  group_by(cluster) %>%
  summarise(
    n_divorcios = n(),
    edad_hombre_promedio = mean(edadhom),
    edad_mujer_promedio = mean(edadmuj),
    edad_hombre_sd = sd(edadhom),
    edad_mujer_sd = sd(edadmuj),
    .groups = "drop"
  ) %>%
  arrange(edad_hombre_promedio)

kable(cluster_summary, digits = 1, 
      caption = "Características de cada cluster (perfiles de edad)")

ggplot(df_cluster, aes(x = edadhom, y = edadmuj, color = cluster)) +
  geom_point(alpha = 0.3, size = 1) +
  labs(title = "Clusters de divorcios según edad de la pareja",
       x = "Edad del hombre",
       y = "Edad de la mujer",
       color = "Cluster") +
  theme_minimal() +
  theme(legend.position = "right")

divorcios_con_cluster <- divorcios_limpio %>%
  select(edadhom, edadmuj, depocu, pueblo_hom, pueblo_muj, eschom, escmuj, anioocu) %>%
  na.omit()

divorcios_con_cluster$cluster <- df_cluster$cluster

### ANALISIS DE CLUSTERS

top_departamentos <- divorcios_con_cluster %>%
  mutate(depocu = as_factor(depocu)) %>%
  count(cluster, depocu, sort = TRUE) %>%
  group_by(cluster) %>%
  slice_head(n = 3) %>%
  ungroup()

kable(top_departamentos, caption = "Top 3 departamentos por cluster")

top_etnia_hom <- divorcios_con_cluster %>%
  count(cluster, pueblo_hom, sort = TRUE) %>%
  group_by(cluster) %>%
  slice_head(n = 3) %>%
  ungroup()

kable(top_etnia_hom, caption = "Top 3 etnias (hombre) por cluster")

top_etnia_muj <- divorcios_con_cluster %>%
  count(cluster, pueblo_muj, sort = TRUE) %>%
  group_by(cluster) %>%
  slice_head(n = 3) %>%
  ungroup()

kable(top_etnia_muj, caption = "Top 3 etnias (mujer) por cluster")

top_educ_hom <- divorcios_con_cluster %>%
  mutate(eschom = as_factor(eschom)) %>%
  count(cluster, eschom, sort = TRUE) %>%
  group_by(cluster) %>%
  slice_head(n = 3) %>%
  ungroup()

kable(top_educ_hom, caption = "Top 3 niveles educativos (hombre) por cluster")

top_educ_muj <- divorcios_con_cluster %>%
  mutate(eschom = as_factor(escmuj)) %>%
  count(cluster, escmuj, sort = TRUE) %>%
  group_by(cluster) %>%
  slice_head(n = 3) %>%
  ungroup()

kable(top_educ_muj, caption = "Top 3 niveles educativos (mujer) por cluster")
```
## Interpretación de los Clusters

### Perfiles Identificados

El análisis de k-means (k=4) identificó cuatro perfiles de edad distintos en las parejas divorciadas:

**Cluster 4 - Parejas Jóvenes** (n=11,954, 36% del total):
- Edad promedio: Hombre 27.3 años, Mujer 24.6 años
- Educación predominante: Diversificado (42%), seguido de Básico (21%)
- Perfil: Parejas que se casaron jóvenes, con educación secundaria/diversificado

**Cluster 1 - Parejas de Edad Media** (n=12,215, 37% del total):
- Edad promedio: Hombre 34.6 años, Mujer 31.9 años
- Educación predominante: Diversificado (39%), con presencia notable de Universitarios (13%)
- Perfil: El grupo más numeroso, con mayor nivel educativo promedio

**Cluster 3 - Parejas Maduras** (n=6,457, 20% del total):
- Edad promedio: Hombre 44.1 años, Mujer 40.3 años
- Educación predominante: Diversificado (28%), Primaria (18%), Universitario (15%)
- Perfil: Parejas con matrimonios más largos antes del divorcio

**Cluster 2 - Parejas Mayores** (n=2,342, 7% del total):
- Edad promedio: Hombre 58.3 años, Mujer 52.4 años
- Educación predominante: Primaria (25%), Diversificado (21%), Ninguno (20%)
- Perfil: Divorcios tardíos, menor nivel educativo que grupos más jóvenes

### Hallazgos Principales

1. **La edad es el único factor diferenciador**: Los clusters se separan claramente por edad de la pareja, mientras que variables geográficas y étnicas muestran distribuciones similares entre todos los grupos.

2. **Patrones geográficos consistentes**: Guatemala, Quetzaltenango y San Marcos concentran la mayoría de divorcios en todos los grupos de edad, reflejando la distribución poblacional del país.

3. **Composición étnica homogénea**: La población Ladino/Mestizo representa aproximadamente 70-75% en todos los clusters, con presencia maya más notable en el Cluster 4 (parejas jóvenes: 18%).

4. **Relación edad-educación**: Se observa que los clusters más jóvenes (1 y 4) tienen mayor proporción de educación Diversificado y Universitario, mientras que el Cluster 2 (parejas mayores) muestra mayor proporción de Primaria y Ninguno, reflejando cambios generacionales en acceso educativo.

5. **Distribución por etapa**: Aproximadamente 73% de los divorcios ocurren en parejas menores de 45 años (Clusters 1 y 4), sugiriendo que los divorcios son más frecuentes en etapas tempranas del matrimonio.



# --- Punto 2 ---

## a) Situación problemática

En Guatemala, el divorcio constituye un fenómeno social que refleja transformaciones en la estructura familiar, las dinámicas de género y las condiciones socioeconómicas del país. A lo largo de los años, se ha mantenido la percepción de que los divorcios son más frecuentes en áreas urbanas, que las personas con mayor nivel educativo tienden a divorciarse a edades más avanzadas y que existe una diferencia de edad constante entre hombres y mujeres al momento de la ruptura matrimonial.

Estas afirmaciones suelen basarse en creencias generales y no siempre en análisis estadísticos formales. Dado que el INE dispone de registros históricos detallados de divorcios, resulta necesario analizar sistemáticamente estos datos para identificar si realmente existen patrones demográficos y geográficos significativos que caractericen el fenómeno.

Se plantea la necesidad de explorar los registros de divorcios para determinar cómo se distribuyen según edad, nivel educativo y ubicación territorial, y si estos factores influyen en el comportamiento observado.

---



## b) Problema científico y objetivos

### Problema científico

¿Existen patrones demográficos, educativos y geográficos significativos que caractericen los divorcios registrados en Guatemala durante el período analizado?

Este problema busca determinar si variables como la edad, el nivel educativo y el departamento influyen en las características del divorcio.

---

### Objetivo General

Analizar exploratoriamente los registros de divorcios en Guatemala para identificar patrones demográficos, educativos y geográficos en el período estudiado.

---

### Objetivos Específicos

1. Describir estadísticamente la edad promedio de hombres y mujeres al momento del divorcio.
2. Analizar la relación entre nivel educativo y edad promedio de divorcio.
3. Evaluar la concentración geográfica de divorcios por departamento.
4. Identificar perfiles de divorcio mediante técnicas de clustering.
5. Interpretar las características de los grupos identificados.

---

## c) Descripción de los datos y proceso de limpieza

El conjunto de datos utilizado proviene del INE y corresponde a registros oficiales de divorcios en formato .sav, integrando más de diez años de información.

Para el análisis fue necesario realizar un proceso de integración y limpieza que incluyó:

- Lectura y unificación de múltiples archivos anuales.
- Estandarización de nombres de variables.
- Homologación de categorías de pertenencia étnica.
- Conversión de variables categóricas a formatos adecuados.
- Tratamiento de valores atípicos en la variable edad con valores mayores a 100 años que fueron reemplazados por NA.
- Revisión y manejo de valores faltantes.

El conjunto final permitió realizar análisis descriptivos, cruces de variables y un análisis de agrupamiento para identificar perfiles característicos de divorcio.

---


## d) Conclusiones del análisis exploratorio

- Se confirma una diferencia estructural por género: en todos los departamentos del país, los hombres presentan una edad promedio mayor que las mujeres al momento del divorcio. Este patrón se mantiene constante independientemente del territorio.

- Existe una relación positiva entre nivel educativo y edad promedio de divorcio. Las personas con educación universitaria y postgrado tienden a divorciarse a edades más avanzadas. Sin embargo, la superposición entre distribuciones indica que la educación es un factor asociado, pero no determinante.

- El departamento de Guatemala concentra aproximadamente el 35% del total de divorcios registrados. Asimismo, los municipios con mayor número de casos corresponden principalmente a áreas urbanas como Guatemala, Mixco, Villa Nueva y Quetzaltenango, lo que respalda la hipótesis de mayor incidencia en sectores urbanos.

- El análisis de clustering permitió identificar cuatro perfiles diferenciados principalmente por edad:
  - Cluster 4 – Parejas Jóvenes (36%): Hombre 27.3 años, Mujer 24.6 años.
  - Cluster 1 – Parejas de Edad Media (37%): Hombre 34.6 años, Mujer 31.9 años.
  - Cluster 3 – Parejas Maduras (20%): Hombre 44.1 años, Mujer 40.3 años.
  - Cluster 2 – Parejas Mayores (7%): Hombre 58.3 años, Mujer 52.4 años.

Aproximadamente el 73% de los divorcios ocurren en parejas menores de 45 años, lo que indica que el fenómeno se concentra principalmente en etapas tempranas y medias de la vida adulta. Por eso la edad se identifica como el principal factor diferenciador entre los clusters obtenidos, mientras que las variables geográficas y étnicas presentan distribuciones similares entre los grupos. Los resultados muestran que el divorcio en Guatemala presenta patrones demográficos estructurados asociados principalmente a la edad y al nivel educativo, con una fuerte concentración en áreas urbanas.
